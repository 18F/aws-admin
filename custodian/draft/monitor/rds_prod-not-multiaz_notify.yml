policies:

- name: rds-prod-multi-az-notify
  resource: rds
  description: |
    Notify on all Prod RDS Instances that are Not Multi AZ setup.
  mode:
    type: cloudtrail
    events:
      - source: rds.amazonaws.com
        event: CreateDBInstance
        ids: "requestParameters.dBInstanceIdentifier"
  filters:
    - type: value
      key: 'tag:Environment'
      value: '^prod'
      op: regex
    - MultiAZ: false
  actions:
   - type: notify
     action_desc: |
        Custodian has identified this production RDS instance in not running in Multiple Availablity Zone. 
        Please modify the RDS instance to be MultiAZ or correctly tag for exemption.
     subject: "Production RDS Instance not MultiAZ"
     to: ["slack"]
     transport:
       type: sqs
       queue: MESSAGEQUEUENAME
     violation_desc: "Production RDS Instance not MultiAZ"
